apiVersion: v1
kind: Secret
metadata:
  name: securevibe-secrets
  namespace: securevibe
  labels:
    app.kubernetes.io/name: securevibe
    app.kubernetes.io/component: secrets
type: Opaque
stringData:
  # Database Credentials
  # IMPORTANT: These should be managed by external secret operator (Vault/AWS Secrets Manager)
  # For initial setup only - rotate immediately after deployment
  DB_USER: "securevibe_app"
  DB_PASSWORD: "REPLACE_WITH_ACTUAL_PASSWORD"
  
  # JWT Secrets - Must be at least 32 characters, cryptographically random
  JWT_SECRET: "REPLACE_WITH_32_CHAR_RANDOM_SECRET"
  JWT_REFRESH_SECRET: "REPLACE_WITH_32_CHAR_RANDOM_SECRET"
  
  # Encryption Keys
  ENCRYPTION_KEY: "REPLACE_WITH_32_BYTE_BASE64_KEY"
  
  # API Keys
  INTERNAL_API_KEY: "REPLACE_WITH_INTERNAL_API_KEY"
  WEBHOOK_SECRET: "REPLACE_WITH_WEBHOOK_SECRET"
  
  # Email Credentials
  SMTP_USER: "apikey"
  SMTP_PASSWORD: "REPLACE_WITH_SENDGRID_API_KEY"
  
  # Redis Password (if using authenticated Redis)
  REDIS_PASSWORD: "REPLACE_WITH_REDIS_PASSWORD"
  
  # OAuth Secrets (if using OAuth providers)
  GOOGLE_CLIENT_SECRET: "REPLACE_WITH_GOOGLE_SECRET"
  GITHUB_CLIENT_SECRET: "REPLACE_WITH_GITHUB_SECRET"
  
  # Monitoring/APM
  SENTRY_DSN: "REPLACE_WITH_SENTRY_DSN"
  DATADOG_API_KEY: "REPLACE_WITH_DATADOG_KEY"
---
# ExternalSecret configuration for Vault integration
# Requires External Secrets Operator to be installed
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: securevibe-vault-secrets
  namespace: securevibe
  labels:
    app.kubernetes.io/name: securevibe
    app.kubernetes.io/component: external-secrets
spec:
  refreshInterval: "1h"
  secretStoreRef:
    name: vault-backend
    kind: SecretStore
  target:
    name: securevibe-secrets
    creationPolicy: Owner
    template:
      type: Opaque
      data:
        DB_USER: "{{ .db_user }}"
        DB_PASSWORD: "{{ .db_password }}"
        JWT_SECRET: "{{ .jwt_secret }}"
        JWT_REFRESH_SECRET: "{{ .jwt_refresh_secret }}"
        ENCRYPTION_KEY: "{{ .encryption_key }}"
        SMTP_PASSWORD: "{{ .smtp_password }}"
        REDIS_PASSWORD: "{{ .redis_password }}"
  data:
    - secretKey: db_user
      remoteRef:
        key: securevibe/database
        property: username
    - secretKey: db_password
      remoteRef:
        key: securevibe/database
        property: password
    - secretKey: jwt_secret
      remoteRef:
        key: securevibe/auth
        property: jwt_secret
    - secretKey: jwt_refresh_secret
      remoteRef:
        key: securevibe/auth
        property: jwt_refresh_secret
    - secretKey: encryption_key
      remoteRef:
        key: securevibe/encryption
        property: key
    - secretKey: smtp_password
      remoteRef:
        key: securevibe/email
        property: password
    - secretKey: redis_password
      remoteRef:
        key: securevibe/cache
        property: password
---
# SealedSecret example for sealed-secrets controller
# Use kubeseal to encrypt: kubeseal --format=yaml < secret.yaml > sealed-secret.yaml
apiVersion: bitnami.com/v1alpha1
kind: SealedSecret
metadata:
  name: securevibe-sealed-secrets
  namespace: securevibe
spec:
  encryptedData:
    DB_USER: AgBy...encrypted...
    DB_PASSWORD: AgBy...encrypted...
    JWT_SECRET: AgBy...encrypted...
  template:
    type: Opaque
    metadata:
      labels:
        app.kubernetes.io/name: securevibe
        sealedsecrets.bitnami.com/managed: "true"