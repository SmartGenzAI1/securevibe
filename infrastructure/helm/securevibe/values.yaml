# =============================================================================
# SecureVibe Helm Chart - Default Values
# =============================================================================

# Global settings
global:
  imagePullSecrets: []
  environment: production

# Image configuration
image:
  repository: ghcr.io/securevibe/securevibe
  tag: latest
  pullPolicy: Always

# Replica count
replicaCount: 3

# Pod annotations
podAnnotations: {}

# Pod labels
podLabels: {}

# Service account
serviceAccount:
  create: true
  name: securevibe
  annotations: {}
  automountServiceAccountToken: false

# Pod security context
podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1001
  runAsGroup: 1001
  fsGroup: 1001
  seccompProfile:
    type: RuntimeDefault

# Container security context
securityContext:
  allowPrivilegeEscalation: false
  readOnlyRootFilesystem: true
  runAsNonRoot: true
  runAsUser: 1001
  capabilities:
    drop:
      - ALL

# Service configuration
service:
  type: ClusterIP
  port: 80
  targetPort: 3000
  annotations: {}

# Ingress configuration
ingress:
  enabled: true
  className: nginx
  annotations:
    cert-manager.io/cluster-issuer: letsencrypt-prod
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
    nginx.ingress.kubernetes.io/limit-rps: "10"
    nginx.ingress.kubernetes.io/enable-cors: "true"
    nginx.ingress.kubernetes.io/cors-allow-origin: "https://securevibe.io, https://*.securevibe.io"
  hosts:
    - host: securevibe.io
      paths:
        - path: /
          pathType: Prefix
    - host: www.securevibe.io
      paths:
        - path: /
          pathType: Prefix
    - host: api.securevibe.io
      paths:
        - path: /
          pathType: Prefix
  tls:
    - secretName: securevibe-tls
      hosts:
        - securevibe.io
        - www.securevibe.io
        - api.securevibe.io

# Resource limits and requests
resources:
  limits:
    cpu: 1000m
    memory: 1Gi
  requests:
    cpu: 250m
    memory: 256Mi

# Horizontal Pod Autoscaler
autoscaling:
  enabled: true
  minReplicas: 3
  maxReplicas: 20
  targetCPUUtilizationPercentage: 70
  targetMemoryUtilizationPercentage: 80
  behavior:
    scaleDown:
      stabilizationWindowSeconds: 300
      policies:
        - type: Percent
          value: 10
          periodSeconds: 60
    scaleUp:
      stabilizationWindowSeconds: 0
      policies:
        - type: Percent
          value: 100
          periodSeconds: 15

# Pod Disruption Budget
podDisruptionBudget:
  enabled: true
  minAvailable: 2

# Liveness probe
livenessProbe:
  httpGet:
    path: /health
    port: http
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3
  successThreshold: 1

# Readiness probe
readinessProbe:
  httpGet:
    path: /health/ready
    port: http
  initialDelaySeconds: 5
  periodSeconds: 5
  timeoutSeconds: 3
  failureThreshold: 3
  successThreshold: 1

# Startup probe
startupProbe:
  httpGet:
    path: /health
    port: http
  initialDelaySeconds: 10
  periodSeconds: 5
  timeoutSeconds: 3
  failureThreshold: 30

# Node selector
nodeSelector: {}

# Tolerations
tolerations: []

# Affinity
affinity:
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        podAffinityTerm:
          labelSelector:
            matchExpressions:
              - key: app.kubernetes.io/name
                operator: In
                values:
                  - securevibe
          topologyKey: kubernetes.io/hostname

# Topology spread constraints
topologySpreadConstraints:
  - maxSkew: 1
    topologyKey: topology.kubernetes.io/zone
    whenUnsatisfiable: ScheduleAnyway

# Environment variables from ConfigMap
configMap:
  create: true
  name: securevibe-config
  data:
    NODE_ENV: "production"
    PORT: "3000"
    DB_HOST: "securevibe-db.securevibe.svc.cluster.local"
    DB_PORT: "5432"
    DB_NAME: "securevibe"
    DB_POOL_MIN: "2"
    DB_POOL_MAX: "10"
    REDIS_HOST: "securevibe-redis.securevibe.svc.cluster.local"
    REDIS_PORT: "6379"
    REDIS_DB: "0"
    REDIS_KEY_PREFIX: "sv:"
    BCRYPT_ROUNDS: "12"
    JWT_EXPIRES_IN: "15m"
    JWT_REFRESH_EXPIRES_IN: "7d"
    SESSION_TIMEOUT: "3600"
    MAX_LOGIN_ATTEMPTS: "5"
    LOCKOUT_DURATION: "900"
    RATE_LIMIT_WINDOW_MS: "900000"
    RATE_LIMIT_MAX_REQUESTS: "100"
    AUTH_RATE_LIMIT_MAX: "5"
    ENABLE_MFA: "true"
    ENABLE_WEBHOOKS: "true"
    ENABLE_AUDIT_LOG: "true"
    ENABLE_ANALYTICS: "true"
    LOG_LEVEL: "info"
    LOG_FORMAT: "json"
    CORS_ORIGIN: "https://securevibe.io,https://*.securevibe.io"
    SMTP_HOST: "smtp.sendgrid.net"
    SMTP_PORT: "587"
    SMTP_SECURE: "false"
    EMAIL_FROM: "noreply@securevibe.io"
    METRICS_ENABLED: "true"
    HEALTH_CHECK_PATH: "/health"
    CACHE_TTL: "300"
    CACHE_CHECK_PERIOD: "60"

# Environment variables from Secret
secret:
  create: true
  name: securevibe-secrets
  stringData:
    DB_USER: "securevibe_app"
    DB_PASSWORD: "REPLACE_WITH_ACTUAL_PASSWORD"
    JWT_SECRET: "REPLACE_WITH_32_CHAR_RANDOM_SECRET"
    JWT_REFRESH_SECRET: "REPLACE_WITH_32_CHAR_RANDOM_SECRET"
    ENCRYPTION_KEY: "REPLACE_WITH_32_BYTE_BASE64_KEY"
    INTERNAL_API_KEY: "REPLACE_WITH_INTERNAL_API_KEY"
    WEBHOOK_SECRET: "REPLACE_WITH_WEBHOOK_SECRET"
    SMTP_USER: "apikey"
    SMTP_PASSWORD: "REPLACE_WITH_SENDGRID_API_KEY"
    REDIS_PASSWORD: "REPLACE_WITH_REDIS_PASSWORD"
    GOOGLE_CLIENT_SECRET: "REPLACE_WITH_GOOGLE_SECRET"
    GITHUB_CLIENT_SECRET: "REPLACE_WITH_GITHUB_SECRET"
    SENTRY_DSN: "REPLACE_WITH_SENTRY_DSN"
    DATADOG_API_KEY: "REPLACE_WITH_DATADOG_KEY"

# External secret management (Vault/External Secrets Operator)
externalSecret:
  enabled: false
  secretStoreName: vault-backend
  refreshInterval: 1h

# Service monitor for Prometheus
serviceMonitor:
  enabled: true
  namespace: monitoring
  interval: 30s
  scrapeTimeout: 10s
  labels:
    release: prometheus

# Pod network policy
networkPolicy:
  enabled: true
  policyTypes:
    - Ingress
    - Egress

# Volume mounts
volumeMounts:
  - name: tmp
    mountPath: /tmp
  - name: logs
    mountPath: /app/logs

# Volumes
volumes:
  - name: tmp
    emptyDir: {}
  - name: logs
    emptyDir:
      sizeLimit: 100Mi

# Init containers
initContainers: []

# Sidecar containers
sidecars: []

# Priority class
priorityClassName: ""

# Termination grace period
terminationGracePeriodSeconds: 60

# Lifecycle hooks
lifecycle: {}

# DNS policy
dnsPolicy: ClusterFirst

# DNS config
dnsConfig: {}

# Host aliases
hostAliases: []

# Extra environment variables
extraEnv: []

# Extra volumes
extraVolumes: []

# Extra volume mounts
extraVolumeMounts: []